/* "@(#)H2DScan.c Nov 19  1:12:04 2022" */
/* Generated by XDS Oberon-2 to ANSI C v4.20 translator */

#define X2C_int32
#define X2C_index32
#ifndef H2DScan_H_
#include "H2DScan.h"
#endif
#define H2DScan_C_
#ifndef H2DObjs_H_
#include "H2DObjs.h"
#endif
#ifndef adt_H_
#include "adt.h"
#endif
#ifndef LongStrs_H_
#include "LongStrs.h"
#endif
#ifndef H2DMsg_H_
#include "H2DMsg.h"
#endif
#ifndef H2DFile_H_
#include "H2DFile.h"
#endif
#ifndef IOChan_H_
#include "IOChan.h"
#endif
#ifndef Printf_H_
#include "Printf.h"
#endif
#ifndef ConvTypes_H_
#include "ConvTypes.h"
#endif
#ifndef WholeStr_H_
#include "WholeStr.h"
#endif
#ifndef H2DCfg_H_
#include "H2DCfg.h"
#endif
#ifndef LongConv_H_
#include "LongConv.h"
#endif

extern struct X2C_MD_STR H2DScan_desc;
static X2C_INT32 H2DScan_MAX_INT = X2C_max_longint;

static X2C_CARD32 H2DScan_MAX_CARD = X2C_max_longcard;

#define H2DScan_line_len 200

#define H2DScan_name_len 200

struct H2DScan_FileDesc;
extern struct X2C_TD_STR H2DScan_FileDesc_desc;


static X2C_PROC H2DScan_TokenDesc_proc[] = {
   (X2C_PROC)adt_Compare
};
static void * H2DScan_TokenDesc_offs[] = {
   X2C_OFS(struct H2DScan_TokenDesc,text),
   X2C_OFS(struct H2DScan_TokenDesc,original_text),
   X2C_OFS(struct H2DScan_TokenDesc,file),
   X2C_OFS_END
};
struct X2C_TD_STR H2DScan_TokenDesc_desc = {
   sizeof(struct H2DScan_TokenDesc), "TokenDesc",
   &H2DScan_desc, &H2DScan_FileDesc_desc, 1, 1,
   { &adt_ElementDesc_desc, &H2DScan_TokenDesc_desc, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0 },
   H2DScan_TokenDesc_proc, H2DScan_TokenDesc_offs, 0, 0, 0,
                &H2DScan_TokenDesc_desc, 0x93678150lu
};

static X2C_CHAR H2DScan_SPACE = 0x20U ;

static X2C_CHAR H2DScan_HTAB = 0xBU ;

static X2C_CHAR H2DScan_GTAB = 0x9U ;

static X2C_CHAR H2DScan_FF = 0xCU ;

static X2C_CHAR H2DScan_EOF = '\032';

static X2C_CHAR H2DScan_EOL = 0;

typedef struct H2DScan_FileDesc * File;


struct H2DScan_FileDesc {
   X2C_INT32 _dummy_;
   LongStrs_String name;
   X2C_BOOLEAN was_blank0;
   adt_Stack replacements0;
   H2DObjs_Replacement replacement0;
   X2C_BOOLEAN pd_parsed0;
   X2C_BOOLEAN pd_define_parsed0;
   X2C_BOOLEAN pd_include_parsed0;
   X2C_BOOLEAN pd_header_parsed0;
   X2C_BOOLEAN transparent_numeration;
   IOChan_ChanId handler0;
   LongStrs_String scanstr0;
   X2C_INT32 line0;
   X2C_INT32 pos0;
   X2C_INT32 total_lines0;
   X2C_BOOLEAN comments;
   X2C_INT32 line_of_last_token_begin0;
   X2C_INT32 pos_of_last_token_begin0;
};
static X2C_PROC H2DScan_FileDesc_proc[] = {
   (X2C_PROC)adt_Compare0,
   (X2C_PROC)adt_SetName
};
static void * H2DScan_FileDesc_offs[] = {
   X2C_OFS(struct H2DScan_FileDesc,name),
   X2C_OFS(struct H2DScan_FileDesc,replacements0),
   X2C_OFS(struct H2DScan_FileDesc,replacement0),
   X2C_OFS(struct H2DScan_FileDesc,scanstr0),
   X2C_OFS_END
};
struct X2C_TD_STR H2DScan_FileDesc_desc = {
   sizeof(struct H2DScan_FileDesc), "FileDesc",
   &H2DScan_desc, 0, 2, 2,
   { &adt_ElementDesc_desc, &adt_NamedElementDesc_desc,
                &H2DScan_FileDesc_desc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                0 },
   H2DScan_FileDesc_proc, H2DScan_FileDesc_offs, 0, 0, 0,
                &H2DScan_FileDesc_desc, 0x93678150lu
};

struct H2DScan_KeyWordDesc;
extern struct X2C_TD_STR H2DScan_KeyWordDesc_desc;

typedef struct H2DScan_KeyWordDesc * KeyWord;


struct H2DScan_KeyWordDesc {
   X2C_INT32 _dummy_;
   LongStrs_String name;
   X2C_INT32 code;
   X2C_BOOLEAN ext;
};
static X2C_PROC H2DScan_KeyWordDesc_proc[] = {
   (X2C_PROC)adt_Compare0,
   (X2C_PROC)adt_SetName
};
static void * H2DScan_KeyWordDesc_offs[] = {
   X2C_OFS(struct H2DScan_KeyWordDesc,name),
   X2C_OFS_END
};
struct X2C_TD_STR H2DScan_KeyWordDesc_desc = {
   sizeof(struct H2DScan_KeyWordDesc), "KeyWordDesc",
   &H2DScan_desc, &H2DScan_TokenDesc_desc, 2, 2,
   { &adt_ElementDesc_desc, &adt_NamedElementDesc_desc,
                &H2DScan_KeyWordDesc_desc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0 },
   H2DScan_KeyWordDesc_proc, H2DScan_KeyWordDesc_offs, 0, 0, 0,
                &H2DScan_KeyWordDesc_desc, 0x93678150lu
};

static X2C_BOOLEAN read_file_exists;

static adt_Tree keywords;

static adt_Tree preprocessor_directives;

static IOChan_ChanId handler;

static LongStrs_String file_name;

static adt_Stack files_stack;

static adt_Stack replacements;

static H2DObjs_Replacement replacement;

static X2C_BOOLEAN replace_on;

static LongStrs_String scanstr;

static X2C_BOOLEAN pd_parsed;

static X2C_BOOLEAN pd_define_parsed;

static X2C_BOOLEAN pd_include_parsed;

static X2C_BOOLEAN pd_header_parsed;

static X2C_CHAR non_presentable_char_array[256];

static X2C_BOOLEAN was_blank;

static X2C_INT32 total_lines;

static X2C_INT32 line;

static X2C_INT32 pos;

static X2C_INT32 line_of_last_token_begin;

static X2C_INT32 pos_of_last_token_begin;

static adt_List tokens;

static X2C_BOOLEAN skipp_eol;

static X2C_BOOLEAN was_eof;

static X2C_BOOLEAN bad_const;

static LongStrs_String logicalStr;

static LongStrs_String prevLogicalStr;

X2C_INT32 H2DScan_token0;
LongStrs_String H2DScan_text;
X2C_INT32 H2DScan_last_header_total_line;
LongStrs_String H2DScan_original_text;
X2C_BOOLEAN H2DScan_skipping_mode;
X2C_BOOLEAN H2DScan_extensions;
X2C_BOOLEAN H2DScan_transparent_numeration;
X2C_BOOLEAN H2DScan_comments;
X2C_BOOLEAN H2DScan_prj_cfg_on;

static void Error(X2C_INT32 number, X2C_LOC x[], X2C_CARD32 x_len)
{
   X2C_CALL(H2DMsg_Error_,X2C_GET_TD(H2DObjs_CurrentHeader->stat),
                3)(H2DObjs_CurrentHeader->stat, number, file_name->Adr,
                file_name->Len0, line, pos+1L, x, x_len);
   H2DScan_Close();
} /* end Error() */


static void Warning(X2C_INT32 number, X2C_LOC x[], X2C_CARD32 x_len)
{
   X2C_CALL(H2DMsg_Warning_,X2C_GET_TD(H2DObjs_CurrentHeader->stat),
                2)(H2DObjs_CurrentHeader->stat, number, file_name->Adr,
                file_name->Len0, line, pos+1L, x, x_len);
} /* end Warning() */


static void RdPartOfScanStr(void)
{
   for (;;) {
      H2DFile_RdStr(handler, &scanstr);
      if (scanstr==0) {
         LongStrs_Assign("", 1ul, &scanstr);
         LongStrs_AppendChar('\032', &scanstr);
         break;
      }
      if (!(scanstr->Adr[0UL]=='\\' && scanstr->Adr[1UL]==0)) {
         ++total_lines;
         ++line;
         break;
      }
   }
   pos = 0L;
} /* end RdPartOfScanStr() */


static void int_to_str(X2C_INT32 int0, LongStrs_String * str)
{
   X2C_CHAR digit[2];
   X2C_INT32 _digit;
   X2C_BOOLEAN neg;
   X2C_BOOLEAN min0;
   neg = int0<0L;
   min0 = int0==X2C_min_longint;
   if (min0) ++int0;
   if (neg) int0 = -int0;
   digit[1UL] = 0;
   do {
      _digit = X2C_MOD(int0,10L);
      if (min0) {
         ++_digit;
         min0 = 0;
      }
      int0 = X2C_DIV(int0,10L)+X2C_DIV(_digit,10L);
      digit[0UL] = (X2C_CHAR)(X2C_MOD(_digit,10L)+48L);
      LongStrs_Insert(digit, 2ul, 0L, str);
   } while (int0);
   if (neg) LongStrs_Insert("-", 2ul, 0L, str);
} /* end int_to_str() */


static void uint_to_str(X2C_CARD32 uint, LongStrs_String * str)
{
   X2C_CHAR digit[2];
   digit[1UL] = 0;
   do {
      digit[0UL] = (X2C_CHAR)(uint%10UL+48UL);
      LongStrs_Insert(digit, 2ul, 0L, str);
      uint = uint/10UL;
   } while (uint);
} /* end uint_to_str() */


static void OutOfRange(LongStrs_String * str, X2C_INT32 type)
{
   X2C_SEQ tmp[3];
   bad_const = 1;
   H2DScan_token0 = type;
   if (type==6076L) LongStrs_Assign("153.0", 6ul, str);
   else LongStrs_Assign("153", 4ul, str);
   if (!H2DScan_skipping_mode) {
      Warning(0L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
   }
} /* end OutOfRange() */


static void WrongFormat(LongStrs_String * str, X2C_INT32 type)
{
   X2C_SEQ tmp[3];
   bad_const = 1;
   H2DScan_token0 = type;
   if (type==6076L) LongStrs_Assign("153.0", 6ul, str);
   else LongStrs_Assign("153", 4ul, str);
   if (!H2DScan_skipping_mode) {
      Warning(1L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
   }
} /* end WrongFormat() */


static X2C_BOOLEAN signed_compute(X2C_INT32 * result, X2C_INT32 type,
                LongStrs_String * str, X2C_INT32 * degree, X2C_INT32 digit,
                X2C_INT32 base)
{
   if (*degree==0L) *degree = 1L;
   else {
      if (X2C_DIV(X2C_max_longint,base)<*degree) {
         OutOfRange(str, type);
         return 1;
      }
      *degree =  *degree*base;
   }
   if (digit==0L) return 0;
   if (X2C_DIV(X2C_max_longint,digit)<*degree || X2C_max_longint- *degree*digit<*result) {
      OutOfRange(str, type);
      return 1;
   }
   else {
      *result +=  *degree*digit;
      return 0;
   }
   return 0;
} /* end signed_compute() */


static X2C_BOOLEAN unsigned_compute(X2C_CARD32 * unsigned_result,
                X2C_INT32 type, LongStrs_String * str,
                X2C_CARD32 * unsigned_degree, X2C_CARD32 digit,
                X2C_CARD32 base)
{
   if (*unsigned_degree==0UL) *unsigned_degree = 1UL;
   else {
      if (X2C_max_longcard/base<*unsigned_degree) {
         OutOfRange(str, type);
         return 1;
      }
      *unsigned_degree =  *unsigned_degree*base;
   }
   if (digit==0UL) return 0;
   if (X2C_max_longcard/digit<*unsigned_degree || X2C_max_longcard- *unsigned_degree*digit<*unsigned_result)
                 {
      OutOfRange(str, type);
      return 1;
   }
   else {
      *unsigned_result +=  *unsigned_degree*digit;
      return 0;
   }
   return 0;
} /* end unsigned_compute() */


static X2C_BOOLEAN compute(X2C_INT32 * degree, X2C_INT32 * result,
                X2C_CARD32 * unsigned_degree, LongStrs_String * str,
                X2C_INT32 type, X2C_CARD32 * unsigned_result,
                X2C_BOOLEAN unsigned0, X2C_INT32 digit, X2C_INT32 base)
{
   if (unsigned0) {
      return unsigned_compute(unsigned_result, type, str, unsigned_degree,
                (X2C_CARD32)digit, (X2C_CARD32)base);
   }
   else return signed_compute(result, type, str, degree, digit, base);
   return 0;
} /* end compute() */


static void check_number(LongStrs_String * str)
{
   X2C_INT32 result;
   X2C_INT32 degree;
   X2C_INT32 i;
   X2C_CARD32 unsigned_result;
   X2C_CARD32 unsigned_degree;
   X2C_BOOLEAN unsigned0;
   X2C_BOOLEAN old_unsigned;
   X2C_BOOLEAN was_x;
   X2C_BOOLEAN was_e;
   X2C_BOOLEAN was_point;
   X2C_CARD8 conv_result;
   X2C_INT32 type;
   i = 0L;
   was_point = 0;
   was_e = 0;
   was_x = 0;
   H2DScan_token0 = 4000L;
   bad_const = 0;
   LongStrs_Capitalize((*str)->Adr, (*str)->Len0);
   while ((*str)->Adr[i]) {
      if (((*str)->Adr[i]=='.' && (X2C_CARD8)(*str)->Adr[i+1L]>='0')
                && (X2C_CARD8)(*str)->Adr[i+1L]<='9') was_point = 1;
      was_e = was_e || (*str)->Adr[i]=='E';
      was_x = was_x || (*str)->Adr[i]=='X';
      ++i;
   }
   if (was_point || !was_x && was_e) {
      if ((*str)->Adr[0UL]=='.') LongStrs_Insert("0", 2ul, 0L, str);
      i = LongStrs_Length((*str)->Adr, (*str)->Len0)-1L;
      if ((*str)->Adr[i]=='F') (*str)->Adr[i] = 0;
      conv_result = LongConv_FormatReal((*str)->Adr, (*str)->Len0);
      type = 6076L;
      H2DScan_token0 = 6076L;
      if (conv_result==ConvTypes_strAllRight) return;
      if (conv_result==ConvTypes_strOutOfRange) {
         OutOfRange(str, type);
         return;
      }
      if (conv_result==ConvTypes_strWrongFormat) {
         WrongFormat(str, type);
         return;
      }
   }
   else {
      result = 0L;
      degree = 0L;
      unsigned_result = 0UL;
      unsigned_degree = 0UL;
      i = LongStrs_Length((*str)->Adr, (*str)->Len0)-1L;
      if ((*str)->Adr[i]=='L') {
         (*str)->Adr[i] = 0;
         --i;
      }
      unsigned0 = (*str)->Adr[i]=='U';
      if (unsigned0) {
         type = 6073L;
         (*str)->Adr[i] = 0;
         --i;
      }
      else type = 6072L;
      if ((*str)->Adr[0UL]=='0') {
         if ((*str)->Adr[1UL]=='X') {
            if (i<=1L) {
               WrongFormat(str, type);
               return;
            }
            if (unsigned0) type = 6075L;
            else type = 6074L;
            old_unsigned = unsigned0;
            unsigned0 = 1;
            while (i>1L) {
               if ((X2C_CARD8)(*str)->Adr[i]>='0' && (X2C_CARD8)(*str)
                ->Adr[i]<='9') {
                  if (compute(&degree, &result, &unsigned_degree, str, type,
                &unsigned_result, unsigned0,
                (X2C_INT32)((X2C_INT16)(X2C_CARD8)(*str)->Adr[i]-48), 16L)) {
                     return;
                  }
               }
               else if ((X2C_CARD8)(*str)->Adr[i]>='A' && (X2C_CARD8)(*str)
                ->Adr[i]<='F') {
                  if (compute(&degree, &result, &unsigned_degree, str, type,
                &unsigned_result, unsigned0,
                (X2C_INT32)(((X2C_INT16)(X2C_CARD8)(*str)->Adr[i]-65)+10),
                16L)) return;
               }
               else {
                  WrongFormat(str, type);
                  return;
               }
               --i;
            }
            unsigned0 = old_unsigned;
            if (!unsigned0) result = (X2C_INT32)unsigned_result;
         }
         else {
            while (i>0L) {
               if ((X2C_CARD8)(*str)->Adr[i]>='0' && (X2C_CARD8)(*str)
                ->Adr[i]<='7') {
                  if (compute(&degree, &result, &unsigned_degree, str, type,
                &unsigned_result, unsigned0,
                (X2C_INT32)((X2C_INT16)(X2C_CARD8)(*str)->Adr[i]-48), 8L)) {
                     return;
                  }
               }
               else {
                  WrongFormat(str, type);
                  return;
               }
               --i;
            }
         }
      }
      else {
         while (i>-1L) {
            if ((X2C_CARD8)(*str)->Adr[i]>='0' && (X2C_CARD8)(*str)
                ->Adr[i]<='9') {
               if (compute(&degree, &result, &unsigned_degree, str, type,
                &unsigned_result, unsigned0,
                (X2C_INT32)((X2C_INT16)(X2C_CARD8)(*str)->Adr[i]-48), 10L)) {
                  return;
               }
            }
            else {
               WrongFormat(str, type);
               return;
            }
            --i;
         }
      }
      LongStrs_Assign("", 1ul, str);
      if (unsigned0) uint_to_str(unsigned_result, str);
      else int_to_str(result, str);
      H2DScan_token0 = type;
   }
} /* end check_number() */


static X2C_BOOLEAN ishexdigit(X2C_CHAR c)
{
   return ((X2C_CARD8)c>='0' && (X2C_CARD8)c<='9' || (X2C_CARD8)
                c>='A' && (X2C_CARD8)c<='F') || (X2C_CARD8)
                c>='a' && (X2C_CARD8)c<='f';
} /* end ishexdigit() */


static X2C_BOOLEAN isoctdigit(X2C_CHAR c)
{
   return (X2C_CARD8)c>='0' && (X2C_CARD8)c<='7';
} /* end isoctdigit() */

static void inc(void);


static void non_presentable_char(X2C_CHAR * char0)
{
   X2C_INT32 digit_num;
   LongStrs_String number = 0;
   X2C_CARD8 res;
   X2C_INT32 code;
   X2C_SEQ tmp[3];
   inc();
   digit_num = 0L;
   if (scanstr->Adr[pos]=='x') {
      inc();
      LongStrs_Assign("0x", 3ul, &number);
      while (digit_num<2L && ishexdigit(scanstr->Adr[pos])) {
         LongStrs_AppendChar(scanstr->Adr[pos], &number);
         inc();
         ++digit_num;
      }
      check_number(&number);
      WholeStr_StrToInt(number->Adr, number->Len0, &code, &res);
      *char0 = (X2C_CHAR)code;
   }
   else if (isoctdigit(scanstr->Adr[pos])) {
      LongStrs_Assign("0", 2ul, &number);
      do {
         LongStrs_AppendChar(scanstr->Adr[pos], &number);
         inc();
         ++digit_num;
      } while (!(digit_num>=3L || !isoctdigit(scanstr->Adr[pos])));
      check_number(&number);
      WholeStr_StrToInt(number->Adr, number->Len0, &code, &res);
      if (code>255L) {
         Warning(0L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
         code = 153L;
      }
      *char0 = (X2C_CHAR)code;
   }
   else {
      *char0 = non_presentable_char_array[(X2C_CARD8)scanstr->Adr[pos]];
      inc();
   }
} /* end non_presentable_char() */


static X2C_BOOLEAN splitter(X2C_CHAR c)
{
   return ((c!='_' && ((X2C_CARD8)c<'A' || (X2C_CARD8)c>'Z')) && ((X2C_CARD8)
                c<'a' || (X2C_CARD8)c>'z')) && ((X2C_CARD8)
                c<'0' || (X2C_CARD8)c>'9');
} /* end splitter() */


static X2C_BOOLEAN nextis(X2C_CHAR c)
{
   return scanstr->Adr[pos+1L]==c;
} /* end nextis() */


static X2C_BOOLEAN is(X2C_INT32 p, X2C_CHAR c)
{
   return scanstr->Adr[p]==c;
} /* end is() */


static void inc(void)
{
   ++pos;
   if ((skipp_eol && is(pos, '\\')) && nextis(0)) {
      RdPartOfScanStr();
      LongStrs_Append(scanstr->Adr, scanstr->Len0, &logicalStr);
   }
} /* end inc() */


static void skip_blanks(void)
{
   was_blank = 0;
   for (;;) {
      switch ((unsigned)scanstr->Adr[pos]) {
      case ' ':
      case '\013':
      case '\011':
      case '\014':
         was_blank = 1;
         inc();
         break;
      default:;
         goto loop_exit;
      } /* end switch */
   }
   loop_exit:;
} /* end skip_blanks() */


static void skip_pd(void)
{
   if ((H2DScan_token0==6058L || H2DScan_token0==6059L)
                || H2DScan_token0==6061L) {
      while (!is(pos, 0)) inc();
      LongStrs_Assign(logicalStr->Adr, logicalStr->Len0, &prevLogicalStr);
      RdPartOfScanStr();
      LongStrs_Assign(scanstr->Adr, scanstr->Len0, &logicalStr);
      pd_parsed = 0;
      H2DScan_GetToken();
      if (H2DMsg_WasError) return;
   }
} /* end skip_pd() */


static void copy_before_splitter(void)
{
   do {
      LongStrs_AppendChar(scanstr->Adr[pos], &H2DScan_text);
      inc();
   } while (!splitter(scanstr->Adr[pos]));
} /* end copy_before_splitter() */

static KeyWord tmp_pattr_for_finding_keywords;


static X2C_BOOLEAN find(adt_Tree t)
{
   adt_Element elem = 0;
   X2C_CALL(adt_SetName_,X2C_GET_TD(tmp_pattr_for_finding_keywords),
                1)((adt_NamedElement)tmp_pattr_for_finding_keywords,
                H2DScan_text->Adr, H2DScan_text->Len0);
   X2C_CALL(adt_Find_,X2C_GET_TD(t),12)(t,
                (adt_Element)tmp_pattr_for_finding_keywords, &elem);
   if (elem==0) return 0;
   else {
      H2DScan_token0 = ((KeyWord)elem)->code;
      return !((KeyWord)elem)->ext || H2DScan_extensions;
   }
   return 0;
} /* end find() */

static adt_List empty_token_list;


static X2C_BOOLEAN getToken(H2DScan_Token * t)
{
   adt_Element e = 0;
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(empty_token_list),6)(empty_token_list,
                 &e);
   if (e==0) *t = 0;
   else {
      *t = (H2DScan_Token)e;
      X2C_CALL(adt_DeleteCurrent_,X2C_GET_TD(empty_token_list),
                3)(empty_token_list);
   }
   return *t!=0;
} /* end getToken() */


static void putToken(H2DScan_Token * t)
{
   X2C_CALL(adt_Insert_0,X2C_GET_TD(empty_token_list),14)(empty_token_list,
                (adt_Element)*t);
   *t = 0;
} /* end putToken() */


static void check_concat_tokens(H2DObjs_Replacement replacement0)
{
   adt_List tokens0 = 0;
   adt_Element e1 = 0;
   adt_Element e = 0;
   H2DScan_Token new_token = 0;
   H2DScan_Token last_token = 0;
   LongStrs_String anonym = 0;
   LongStrs_String anonym0 = 0;
   LongStrs_String anonym1 = 0;
   LongStrs_String anonym2 = 0;
   LongStrs_String anonym3 = 0;
   X2C_SEQ tmp[3];
   adt_NewList(&tokens0);
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(replacement0->tokens),
                6)(replacement0->tokens, &e);
   last_token = (H2DScan_Token)e;
   X2C_CALL(adt_FindNext_0,X2C_GET_TD(replacement0->tokens),
                8)(replacement0->tokens, &e);
   while (e) {
      if (((H2DScan_Token)e)->token==6049L) {
         X2C_CALL(adt_FindNext_0,X2C_GET_TD(replacement0->tokens),
                8)(replacement0->tokens, &e);
         if (X2C_GET_TD(e)->base[1]==&H2DScan_TokenDesc_desc) {
            switch (last_token->token) {
            case 5000L:
            case 5001L:
            case 5002L:
            case 5003L:
            case 5004L:
            case 5005L:
            case 5006L:
            case 5007L:
            case 5008L:
            case 5009L:
            case 5010L:
            case 5011L:
            case 5012L:
            case 5013L:
            case 5014L:
            case 5015L:
            case 5016L:
            case 5017L:
            case 5018L:
            case 5019L:
            case 5020L:
            case 5021L:
            case 5022L:
            case 5023L:
            case 5024L:
            case 5025L:
            case 5026L:
            case 5027L:
            case 5028L:
            case 5029L:
            case 5030L:
            case 5031L:
            case 5032L:
            case 5033L:
            case 5034L:
            case 5035L:
            case 5036L:
            case 5037L:
            case 5038L:
            case 5039L:
            case 5040L:
            case 6001L:
               switch (((H2DScan_Token)e)->token) {
               case 5000L:
               case 5001L:
               case 5002L:
               case 5003L:
               case 5004L:
               case 5005L:
               case 5006L:
               case 5007L:
               case 5008L:
               case 5009L:
               case 5010L:
               case 5011L:
               case 5012L:
               case 5013L:
               case 5014L:
               case 5015L:
               case 5016L:
               case 5017L:
               case 5018L:
               case 5019L:
               case 5020L:
               case 5021L:
               case 5022L:
               case 5023L:
               case 5024L:
               case 5025L:
               case 5026L:
               case 5027L:
               case 5028L:
               case 5029L:
               case 5030L:
               case 5031L:
               case 5032L:
               case 5033L:
               case 5034L:
               case 5035L:
               case 5036L:
               case 5037L:
               case 5038L:
               case 5039L:
               case 5040L:
               case 6001L:
               case 6076L:
               case 6072L:
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6001L;
                  anonym = last_token->original_text;
                  LongStrs_Assign(anonym->Adr, anonym->Len0,
                &new_token->text);
                  anonym0 = ((H2DScan_Token)e)->original_text;
                  LongStrs_Append(anonym0->Adr, anonym0->Len0,
                &new_token->text);
                  anonym1 = new_token->text;
                  LongStrs_Assign(anonym1->Adr, anonym1->Len0,
                &new_token->original_text);
                  last_token = new_token;
                  break;
               default:;
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
                  break;
               } /* end switch */
               break;
            case 6076L:
            case 6072L:
               switch (((H2DScan_Token)e)->token) {
               case 5000L:
               case 5001L:
               case 5002L:
               case 5003L:
               case 5004L:
               case 5005L:
               case 5006L:
               case 5007L:
               case 5008L:
               case 5009L:
               case 5010L:
               case 5011L:
               case 5012L:
               case 5013L:
               case 5014L:
               case 5015L:
               case 5016L:
               case 5017L:
               case 5018L:
               case 5019L:
               case 5020L:
               case 5021L:
               case 5022L:
               case 5023L:
               case 5024L:
               case 5025L:
               case 5026L:
               case 5027L:
               case 5028L:
               case 5029L:
               case 5030L:
               case 5031L:
               case 5032L:
               case 5033L:
               case 5034L:
               case 5035L:
               case 5036L:
               case 5037L:
               case 5038L:
               case 5039L:
               case 5040L:
               case 6001L:
               case 6076L:
               case 6072L:
                  anonym2 = last_token->original_text;
                  LongStrs_Assign(anonym2->Adr, anonym2->Len0,
                &H2DScan_text);
                  anonym3 = ((H2DScan_Token)e)->original_text;
                  LongStrs_Append(anonym3->Adr, anonym3->Len0,
                &H2DScan_text);
                  check_number(&H2DScan_text);
                  last_token = 0;
                  H2DScan_NewToken(&last_token);
                  break;
               default:;
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
                  break;
               } /* end switch */
               break;
            case 6012L:
               if (((H2DScan_Token)e)->token==6013L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6018L;
                  last_token = new_token;
               }
               else {
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
               }
               break;
            case 6013L:
               if (((H2DScan_Token)e)->token==6013L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6078L;
                  last_token = new_token;
               }
               else {
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
               }
               break;
            case 6014L:
               if (((H2DScan_Token)e)->token==6013L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6016L;
                  last_token = new_token;
               }
               else if (((H2DScan_Token)e)->token==6014L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6026L;
                  last_token = new_token;
               }
               else {
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
               }
               break;
            case 6015L:
               if (((H2DScan_Token)e)->token==6013L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6017L;
                  last_token = new_token;
               }
               else if (((H2DScan_Token)e)->token==6015L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6025L;
                  last_token = new_token;
               }
               else {
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
               }
               break;
            case 6022L:
               if (((H2DScan_Token)e)->token==6022L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6029L;
                  last_token = new_token;
               }
               else {
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
               }
               break;
            case 6023L:
               if (((H2DScan_Token)e)->token==6023L) {
                  new_token = 0;
                  H2DScan_NewToken(&new_token);
                  new_token->token = 6028L;
                  last_token = new_token;
               }
               else {
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
                  last_token = (H2DScan_Token)e;
               }
               break;
            default:;
               X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
               X2C_CALL(adt_FindNext_0,X2C_GET_TD(replacement0->tokens),
                8)(replacement0->tokens, &e1);
               last_token = (H2DScan_Token)e1;
               break;
            } /* end switch */
         }
      }
      else {
         if (((H2DScan_Token)e)->token==6048L) {
            Error(2L, (tmp[0].adr = "#", tmp[1].val = 0, tmp[2].val = 2u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
            return;
         }
         X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
         last_token = (H2DScan_Token)e;
      }
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(replacement0->tokens),
                8)(replacement0->tokens, &e);
   }
   X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens0),14)(tokens0,
                (adt_Element)last_token);
   adt_Deallocate((adt_Element)replacement0->tokens);
   replacement0->tokens = tokens0;
} /* end check_concat_tokens() */

struct H2DScan_TDesc;
extern struct X2C_TD_STR H2DScan_TDesc_desc;

typedef struct H2DScan_TDesc * T;


struct H2DScan_TDesc {
   X2C_INT32 _dummy_;
   LongStrs_String name;
   adt_List replacement0;
};
static X2C_PROC H2DScan_TDesc_proc[] = {
   (X2C_PROC)adt_Compare0,
   (X2C_PROC)adt_SetName
};
static void * H2DScan_TDesc_offs[] = {
   X2C_OFS(struct H2DScan_TDesc,name),
   X2C_OFS(struct H2DScan_TDesc,replacement0),
   X2C_OFS_END
};
struct X2C_TD_STR H2DScan_TDesc_desc = {
   sizeof(struct H2DScan_TDesc), "TDesc",
   &H2DScan_desc, &H2DScan_KeyWordDesc_desc, 2, 2,
   { &adt_ElementDesc_desc, &adt_NamedElementDesc_desc, &H2DScan_TDesc_desc,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
   H2DScan_TDesc_proc, H2DScan_TDesc_offs, 0, 0, 0, &H2DScan_TDesc_desc,
                0x93678150lu
};


static X2C_BOOLEAN build_replacement_with_params(H2DObjs_Replacement replacement0)
                
{
   adt_Element e2 = 0;
   adt_Element e1 = 0;
   adt_Element e = 0;
   adt_NamedElement ne = 0;
   adt_List params = 0;
   H2DScan_Token next_token = 0;
   H2DScan_Token t = 0;
   T p = 0;
   X2C_INT32 bracket_balance;
   LongStrs_String anonym = 0;
   LongStrs_String anonym0 = 0;
   LongStrs_String anonym1 = 0;
   LongStrs_String anonym2 = 0;
   adt_List anonym3 = 0;
   adt_List anonym4 = 0;
   X2C_SEQ tmp[3];
   pd_parsed = 1;
   replace_on = 0;
   t = 0;
   H2DScan_NewToken(&t);
   H2DScan_GetToken();
   if (H2DMsg_WasError) return 0;
   next_token = 0;
   H2DScan_NewToken(&next_token);
   if (H2DScan_token0==6006L) {
      H2DScan_GetToken();
      if (H2DMsg_WasError) return 0;
      putToken(&next_token);
      putToken(&t);
   }
   else {
      X2C_CALL(adt_Insert_0,X2C_GET_TD(tokens),14)(tokens,
                (adt_Element)next_token);
      H2DScan_token0 = t->token;
      anonym = t->text;
      LongStrs_Assign(anonym->Adr, anonym->Len0, &H2DScan_text);
      anonym0 = t->original_text;
      LongStrs_Assign(anonym0->Adr, anonym0->Len0, &H2DScan_original_text);
      line = t->_line;
      pos = t->_pos;
      line_of_last_token_begin = t->line0;
      pos_of_last_token_begin = t->pos0;
      replace_on = 1;
      pd_parsed = 0;
      putToken(&t);
      return 0;
   }
   adt_NewList(&params);
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(replacement0->params),
                6)(replacement0->params, &e);
   while (e) {
      X2C_NEW(&H2DScan_TDesc_desc,(X2C_ADDRESS*) &p,
                sizeof(struct H2DScan_TDesc),0);
      anonym1 = ((adt_NamedElement)e)->name;
      X2C_CALL(adt_SetName_,X2C_GET_TD(p),1)((adt_NamedElement)p,
                anonym1->Adr, anonym1->Len0);
      adt_NewList(&p->replacement0);
      X2C_CALL(adt_Insert_0,X2C_GET_TD(params),14)(params, (adt_Element)p);
      bracket_balance = 0L;
      while (bracket_balance>0L || H2DScan_token0!=6005L && H2DScan_token0!=6007L)
                 {
         if (H2DScan_token0==6064L) {
            Error(24L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
            return 0;
         }
         if (H2DScan_token0==6006L) ++bracket_balance;
         else if (H2DScan_token0==6007L) --bracket_balance;
         if (H2DScan_token0!=6063L) {
            t = 0;
            H2DScan_NewToken(&t);
            X2C_CALL(adt_Insert_0,X2C_GET_TD(p->replacement0),
                14)(p->replacement0, (adt_Element)t);
         }
         H2DScan_GetToken();
         if (H2DMsg_WasError) return 0;
      }
      if (X2C_CALL(adt_IsEmpty_1,X2C_GET_TD(p->replacement0),
                4)(p->replacement0)) {
         Error(3L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
         return 0;
      }
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(replacement0->params),
                8)(replacement0->params, &e);
      if (H2DScan_token0==6005L) {
         if (e==0) {
            Error(4L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
            return 0;
         }
         H2DScan_GetToken();
         if (H2DMsg_WasError) return 0;
      }
   }
   adt_NewList(&replacement0->tokens);
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(replacement0->pattern),
                6)(replacement0->pattern, &e);
   while (e) {
      if (X2C_GET_TD(e)->base[1]==&H2DScan_TokenDesc_desc) {
         if (((H2DScan_Token)e)->token==6001L) {
            anonym2 = ((H2DScan_Token)e)->text;
            adt_NewNamedElement(&ne, anonym2->Adr, anonym2->Len0);
            X2C_CALL(adt_Find_0,X2C_GET_TD(params),11)(params,
                (adt_Element)ne, &e1);
            adt_Deallocate((adt_Element)ne);
            if (e1==0) {
               X2C_CALL(adt_Insert_0,X2C_GET_TD(replacement0->tokens),
                14)(replacement0->tokens, (adt_Element)e);
            }
            else {
               anonym3 = ((T)e1)->replacement0;
               X2C_CALL(adt_FindFirst_0,X2C_GET_TD(anonym3),6)(anonym3, &e2);
               while (e2) {
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(replacement0->tokens),
                14)(replacement0->tokens, e2);
                  anonym4 = ((T)e1)->replacement0;
                  X2C_CALL(adt_FindNext_0,X2C_GET_TD(anonym4),8)(anonym4,
                &e2);
               }
            }
         }
         else {
            X2C_CALL(adt_Insert_0,X2C_GET_TD(replacement0->tokens),
                14)(replacement0->tokens, (adt_Element)e);
         }
      }
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(replacement0->pattern),
                8)(replacement0->pattern, &e);
   }
   check_concat_tokens(replacement0);
   replace_on = 1;
   pd_parsed = 0;
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(params),6)(params, &e);
   while (e) {
      LongStrs_Deallocate(&((T)e)->name);
      adt_Deallocate((adt_Element)((T)e)->replacement0);
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(params),8)(params, &e);
   }
   adt_Deallocate((adt_Element)params);
   return 1;
} /* end build_replacement_with_params() */

static H2DObjs_Replacement tmp_pattr_for_finding_replacem;


static X2C_BOOLEAN find_replacement(void)
{
   adt_Element elem = 0;
   H2DObjs_Replacement r = 0;
   X2C_CALL(adt_SetName_,X2C_GET_TD(tmp_pattr_for_finding_replacem),
                1)((adt_NamedElement)tmp_pattr_for_finding_replacem,
                H2DScan_text->Adr, H2DScan_text->Len0);
   elem = 0;
   if (H2DObjs_CurrentHeader) {
      H2DObjs_FindInReplacements(H2DObjs_CurrentHeader,
                (adt_NamedElement)tmp_pattr_for_finding_replacem, &elem);
   }
   if (elem && !((H2DObjs_Replacement)elem)->used) {
      r = (H2DObjs_Replacement)elem;
      if (!X2C_CALL(adt_IsEmpty_1,X2C_GET_TD(r->params),
                4)(r->params) && !build_replacement_with_params(r)) return 0;
      if (H2DMsg_WasError) return 0;
      X2C_CALL(adt_Push_,X2C_GET_TD(replacements),3)(replacements,
                (adt_Element)replacement);
      replacement = r;
      replacement->used = 1;
      X2C_CALL(adt_Reset_,X2C_GET_TD(replacement->tokens),
                9)(replacement->tokens);
      return 1;
   }
   return 0;
} /* end find_replacement() */


static void push_file(void)
{
   File n = 0;
   X2C_NEW(&H2DScan_FileDesc_desc,(X2C_ADDRESS*) &n,
                sizeof(struct H2DScan_FileDesc),0);
   X2C_CALL(adt_SetName_,X2C_GET_TD(n),1)((adt_NamedElement)n,
                file_name->Adr, file_name->Len0);
   n->was_blank0 = was_blank;
   n->pd_parsed0 = pd_parsed;
   n->pd_define_parsed0 = pd_define_parsed;
   n->pd_include_parsed0 = pd_include_parsed;
   n->pd_header_parsed0 = pd_header_parsed;
   n->transparent_numeration = H2DScan_transparent_numeration;
   n->replacement0 = replacement;
   n->replacements0 = replacements;
   n->handler0 = handler;
   n->line0 = line;
   n->pos0 = pos;
   n->scanstr0 = 0;
   n->total_lines0 = total_lines;
   n->comments = H2DScan_comments;
   n->line_of_last_token_begin0 = line_of_last_token_begin;
   n->pos_of_last_token_begin0 = pos_of_last_token_begin;
   LongStrs_Assign(scanstr->Adr, scanstr->Len0, &n->scanstr0);
   X2C_CALL(adt_Push_,X2C_GET_TD(files_stack),3)(files_stack,
                (adt_Element)n);
} /* end push_file() */


static void pop_file(void)
{
   adt_Element elem = 0;
   LongStrs_String anonym = 0;
   LongStrs_String anonym0 = 0;
   X2C_CALL(adt_Pop_,X2C_GET_TD(files_stack),2)(files_stack, &elem);
   if (elem==0) read_file_exists = 0;
   else {
      if (X2C_GET_TD(elem)->base[2]==&H2DScan_FileDesc_desc) {
         was_blank = ((File)elem)->was_blank0;
         pd_parsed = ((File)elem)->pd_parsed0;
         pd_define_parsed = ((File)elem)->pd_define_parsed0;
         pd_include_parsed = ((File)elem)->pd_include_parsed0;
         pd_header_parsed = ((File)elem)->pd_header_parsed0;
         replacement = ((File)elem)->replacement0;
         replacements = ((File)elem)->replacements0;
         H2DScan_transparent_numeration = ((File)elem)
                ->transparent_numeration;
         if (!H2DScan_transparent_numeration) {
            total_lines = ((File)elem)->total_lines0;
         }
         H2DScan_comments = ((File)elem)->comments;
         line_of_last_token_begin = ((File)elem)->line_of_last_token_begin0;
         pos_of_last_token_begin = ((File)elem)->pos_of_last_token_begin0;
         anonym = ((File)elem)->name;
         LongStrs_Assign(anonym->Adr, anonym->Len0, &file_name);
         handler = ((File)elem)->handler0;
         line = ((File)elem)->line0;
         pos = ((File)elem)->pos0;
         anonym0 = ((File)elem)->scanstr0;
         LongStrs_Assign(anonym0->Adr, anonym0->Len0, &scanstr);
      }
      read_file_exists = 1;
   }
} /* end pop_file() */


static void get_str_const(X2C_CHAR border)
{
   LongStrs_String str = 0;
   X2C_CHAR char0;
   X2C_BOOLEAN was_eol;
   X2C_SEQ tmp[3];
   was_eol = 0;
   inc();
   while (!is(pos, border) && !is(pos, 0)) {
      if (is(pos, '\\')) {
         non_presentable_char(&char0);
         if (H2DMsg_WasError) return;
         was_eol = char0==0;
      }
      else {
         char0 = scanstr->Adr[pos];
         inc();
      }
      if (!was_eol) LongStrs_AppendChar(char0, &H2DScan_text);
   }
   if (is(pos, border)) inc();
   else {
      str = 0;
      LongStrs_Assign("\\, ", 4ul, &str);
      LongStrs_AppendChar(border, &str);
      Error(5L, (tmp[0].adr = str->Adr, tmp[1].val = 0,
                tmp[2].val = str->Len0*1u-1, (X2C_LOC *)tmp),
                3ul*sizeof(X2C_SEQ));
   }
} /* end get_str_const() */


static X2C_BOOLEAN get_next_token_from_current_re(void)
{
   adt_Element elem = 0;
   LongStrs_String anonym = 0;
   while (replacement) {
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(replacement->tokens),
                8)(replacement->tokens, &elem);
      if (elem==0) {
         replacement->used = 0;
         if (!X2C_CALL(adt_IsEmpty_1,X2C_GET_TD(replacement->params),
                4)(replacement->params)) {
            adt_Deallocate((adt_Element)replacement->tokens);
            replacement->tokens = 0;
         }
         X2C_CALL(adt_Pop_,X2C_GET_TD(replacements),2)(replacements, &elem);
         replacement = (H2DObjs_Replacement)elem;
      }
      else {
         H2DScan_token0 = ((H2DScan_Token)elem)->token;
         anonym = ((H2DScan_Token)elem)->text;
         LongStrs_Assign(anonym->Adr, anonym->Len0, &H2DScan_text);
         if ((!replace_on || H2DScan_token0!=6001L) || !find_replacement()) {
            return 1;
         }
      }
   }
   return 0;
} /* end get_next_token_from_current_replacement_list() */


static void get_include_name(void)
{
   X2C_CHAR border[2];
   X2C_SEQ tmp[3];
   border[1UL] = 0;
   if (was_blank) {
      if (is(pos, '<')) {
         border[0UL] = '>';
         H2DScan_token0 = 6068L;
      }
      else if (is(pos, '\"')) {
         border[0UL] = '\"';
         H2DScan_token0 = 6069L;
      }
      else {
         Error(5L, (tmp[0].adr = "< , \"", tmp[1].val = 0, tmp[2].val = 6u-1,
                 (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
         return;
      }
      inc();
      while (!is(pos, border[0UL]) && !is(pos, 0)) {
         LongStrs_AppendChar(scanstr->Adr[pos], &H2DScan_text);
         inc();
      }
      if (is(pos, 0)) {
         Error(5L, (tmp[0].adr = border, tmp[1].val = 0, tmp[2].val = 2u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
         return;
      }
   }
   else {
      Error(25L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
      return;
   }
   if (H2DScan_text==0 || H2DScan_text->Adr[0UL]==0) {
      Error(26L, (tmp[0].adr = "", tmp[1].val = 0, tmp[2].val = 1u-1,
                (X2C_LOC *)tmp), 3ul*sizeof(X2C_SEQ));
      return;
   }
   inc();
} /* end get_include_name() */

static LongStrs_String tmp_str_for_formatting_comment;


static void append_spaces(LongStrs_String * str, X2C_INT32 len)
{
   X2C_INT32 i;
   i = LongStrs_Length1(*str);
   LongStrs_Assign("", 1ul, &tmp_str_for_formatting_comment);
   while (i<len) {
      LongStrs_Append(" ", 2ul, &tmp_str_for_formatting_comment);
      ++i;
   }
   LongStrs_Append(tmp_str_for_formatting_comment->Adr,
                tmp_str_for_formatting_comment->Len0, str);
} /* end append_spaces() */


static X2C_INT32 lead_spaces_num(const X2C_CHAR str[], X2C_CARD32 str_len)
{
   X2C_INT32 i;
   i = 0L;
   while (str[i]==' ') ++i;
   return i;
} /* end lead_spaces_num() */


static void format_comments(adt_List comments, X2C_INT32 pos0)
{
   X2C_INT32 max_size;
   adt_Element e = 0;
   LongStrs_String tmp_str = 0;
   X2C_INT32 min_lead_spaces_num;
   X2C_INT32 tmp;
   LongStrs_String anonym = 0;
   LongStrs_String anonym0 = 0;
   LongStrs_String anonym1 = 0;
   max_size = 0L;
   tmp_str = 0;
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(comments),6)(comments, &e);
   append_spaces(&tmp_str, pos0+2L);
   anonym = ((H2DScan_Token)e)->text;
   LongStrs_Append(anonym->Adr, anonym->Len0, &tmp_str);
   ((H2DScan_Token)e)->text = tmp_str;
   X2C_CALL(adt_FindLast_0,X2C_GET_TD(comments),5)(comments, &e);
   append_spaces(&((H2DScan_Token)e)->text, 2L);
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(comments),6)(comments, &e);
   while (e) {
      if (max_size<LongStrs_Length1(((H2DScan_Token)e)->text)) {
         max_size = LongStrs_Length1(((H2DScan_Token)e)->text);
      }
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(comments),8)(comments, &e);
   }
   ++max_size;
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(comments),6)(comments, &e);
   while (e) {
      append_spaces(&((H2DScan_Token)e)->text, max_size);
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(comments),8)(comments, &e);
   }
   min_lead_spaces_num = X2C_max_longint;
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(comments),6)(comments, &e);
   while (e) {
      tmp = (anonym0 = ((H2DScan_Token)e)->text,lead_spaces_num(anonym0->Adr,
                 anonym0->Len0));
      if (tmp<min_lead_spaces_num) min_lead_spaces_num = tmp;
      X2C_CALL(adt_FindNext_0,X2C_GET_TD(comments),8)(comments, &e);
   }
   --min_lead_spaces_num;
   if (min_lead_spaces_num>0L) {
      X2C_CALL(adt_FindFirst_0,X2C_GET_TD(comments),6)(comments, &e);
      while (e) {
         anonym1 = ((H2DScan_Token)e)->text;
         LongStrs_Delete(anonym1->Adr, anonym1->Len0, 0L,
                min_lead_spaces_num);
         X2C_CALL(adt_FindNext_0,X2C_GET_TD(comments),8)(comments, &e);
      }
   }
} /* end format_comments() */


extern void H2DScan_NewToken(H2DScan_Token * tok)
{
   if (*tok==0 && !getToken(tok)) {
      X2C_NEW(&H2DScan_TokenDesc_desc,(X2C_ADDRESS*)tok,
                sizeof(struct H2DScan_TokenDesc),0);
      (*tok)->text = 0;
      (*tok)->original_text = 0;
      (*tok)->file = 0;
   }
   (*tok)->token = H2DScan_token0;
   LongStrs_Assign(H2DScan_text->Adr, H2DScan_text->Len0, &(*tok)->text);
   LongStrs_Assign(H2DScan_original_text->Adr, H2DScan_original_text->Len0,
                &(*tok)->original_text);
   (*tok)->parsed = 0;
   (*tok)->boundary = 0;
   (*tok)->line0 = line_of_last_token_begin;
   (*tok)->pos0 = pos_of_last_token_begin;
   LongStrs_Assign(file_name->Adr, file_name->Len0, &(*tok)->file);
   (*tok)->_line = line;
   (*tok)->_pos = pos;
   (*tok)->pretoken = 0;
} /* end NewToken() */


extern void H2DScan_Init(void)
{
   handler = 0;
   replacement = 0;
   LongStrs_Assign("", 1ul, &scanstr);
   LongStrs_Assign("", 1ul, &H2DScan_original_text);
   LongStrs_Assign("", 1ul, &H2DScan_text);
   pd_parsed = 0;
   pd_define_parsed = 0;
   pd_include_parsed = 0;
   was_blank = 0;
   pd_header_parsed = 0;
   read_file_exists = 0;
   replace_on = 1;
   H2DScan_comments = 1;
   H2DScan_skipping_mode = 0;
   skipp_eol = 1;
   H2DScan_transparent_numeration = 0;
   total_lines = 0L;
   line = 0L;
   pos = 0L;
   line_of_last_token_begin = 0L;
   pos_of_last_token_begin = 0L;
   H2DScan_token0 = 6077L;
   adt_Deallocate((adt_Element)files_stack);
   adt_NewStack(&files_stack);
   adt_Deallocate((adt_Element)replacements);
   adt_NewStack(&replacements);
   adt_Deallocate((adt_Element)tokens);
   adt_NewList(&tokens);
} /* end Init() */


extern X2C_BOOLEAN H2DScan_Open(X2C_CHAR name[], X2C_CARD32 name_len)
{
   if (read_file_exists) push_file();
   file_name = 0;
   if (H2DFile_Open(name, name_len, 1L, &handler, 0x8U)) {
      pd_parsed = 0;
      pd_define_parsed = 0;
      pd_include_parsed = 0;
      pd_header_parsed = 0;
      H2DScan_comments = 1;
      replacement = 0;
      adt_NewStack(&replacements);
      LongStrs_Assign(name, name_len, &file_name);
      read_file_exists = 1;
      scanstr = 0;
      line = 0L;
      pos = 0L;
      if (!H2DScan_transparent_numeration || X2C_CALL(adt_IsEmpty_,
                X2C_GET_TD(files_stack),1)(files_stack)) total_lines = 0L;
      RdPartOfScanStr();
      LongStrs_Assign(scanstr->Adr, scanstr->Len0, &logicalStr);
      LongStrs_Assign("", 1ul, &prevLogicalStr);
      was_eof = 0;
      return 1;
   }
   else {
      read_file_exists = 0;
      return 0;
   }
   return 0;
} /* end Open() */


extern void H2DScan_Close(void)
{
   adt_Element elem = 0;
   if (read_file_exists) {
      H2DFile_Close(handler);
      read_file_exists = 0;
   }
   X2C_CALL(adt_Pop_,X2C_GET_TD(files_stack),2)(files_stack, &elem);
   while (elem) {
      H2DFile_Close(((File)elem)->handler0);
      X2C_CALL(adt_Pop_,X2C_GET_TD(files_stack),2)(files_stack, &elem);
   }
} /* end Close() */


extern void H2DScan_GetPrevLogicalString(LongStrs_String * str)
{
   LongStrs_Assign(prevLogicalStr->Adr, prevLogicalStr->Len0, str);
} /* end GetPrevLogicalString() */


extern void H2DScan_GetToken(void)
{
   LongStrs_String str = 0;
   X2C_INT32 old_pos;
   X2C_INT32 old_line;
   X2C_BOOLEAN tmp;
   X2C_BOOLEAN begin_of_line;
   adt_Element e = 0;
   H2DScan_Token next_token = 0;
   adt_List comments_list = 0;
   LongStrs_String anonym = 0;
   LongStrs_String anonym0 = 0;
   LongStrs_String anonym1 = 0;
   X2C_SEQ tmp0[3];
   if (was_eof) {
      pop_file();
      was_eof = 0;
   }
   X2C_CALL(adt_FindFirst_0,X2C_GET_TD(tokens),6)(tokens, &e);
   if (e) {
      if (X2C_GET_TD(e)->base[1]==&H2DScan_TokenDesc_desc) {
         H2DScan_token0 = ((H2DScan_Token)e)->token;
         anonym = ((H2DScan_Token)e)->text;
         LongStrs_Assign(anonym->Adr, anonym->Len0, &H2DScan_text);
         anonym0 = ((H2DScan_Token)e)->original_text;
         LongStrs_Assign(anonym0->Adr, anonym0->Len0,
                &H2DScan_original_text);
         line = ((H2DScan_Token)e)->_line;
         pos = ((H2DScan_Token)e)->_pos;
         line_of_last_token_begin = ((H2DScan_Token)e)->line0;
         pos_of_last_token_begin = ((H2DScan_Token)e)->pos0;
         X2C_CALL(adt_DeleteCurrent_,X2C_GET_TD(tokens),3)(tokens);
      }
      putToken((H2DScan_Token *) &e);
      return;
   }
   LongStrs_Assign("", 1ul, &H2DScan_text);
   LongStrs_Assign("", 1ul, &H2DScan_original_text);
   if (get_next_token_from_current_re()) return;
   if (read_file_exists) {
      begin_of_line = pos==0L;
      skip_blanks();
      line_of_last_token_begin = line;
      pos_of_last_token_begin = pos;
      if (pd_header_parsed && scanstr->Adr[pos]) {
         get_include_name();
         if (H2DMsg_WasError) return;
         return;
      }
      if (pd_include_parsed) {
         get_include_name();
         if (H2DMsg_WasError) return;
         pd_include_parsed = 0;
         return;
      }
      LongStrs_Assign("", 1ul, &H2DScan_text);
      LongStrs_Assign("", 1ul, &H2DScan_original_text);
      H2DScan_token0 = 6077L;
      if (H2DScan_prj_cfg_on) {
         if (begin_of_line && scanstr->Adr[pos]=='!') {
            scanstr->Adr[pos] = '#';
         }
         if (scanstr->Adr[pos]=='%') {
            scanstr->Adr[pos] = '/';
            if (scanstr->Adr[pos]==0) LongStrs_AppendChar('/', &scanstr);
            else scanstr->Adr[pos+1L] = '/';
         }
      }
      switch ((unsigned)scanstr->Adr[pos]) {
      case 0:
         LongStrs_Assign(logicalStr->Adr, logicalStr->Len0, &prevLogicalStr);
         RdPartOfScanStr();
         LongStrs_Assign(scanstr->Adr, scanstr->Len0, &logicalStr);
         if (pd_parsed) {
            pd_parsed = 0;
            pd_define_parsed = 0;
            pd_include_parsed = 0;
            pd_header_parsed = 0;
            H2DScan_comments = 1;
            H2DScan_token0 = 6063L;
         }
         else {
            H2DScan_GetToken();
            if (H2DMsg_WasError) return;
         }
         break;
      case '\032':
         H2DScan_token0 = 6064L;
         was_eof = 1;
         H2DScan_last_header_total_line = total_lines;
         H2DFile_Close(handler);
         read_file_exists = 0;
         break;
      case '!':
         if (nextis('=')) {
            H2DScan_token0 = 6018L;
            inc();
         }
         else H2DScan_token0 = 6012L;
         inc();
         break;
      case '\"':
         get_str_const('\"');
         if (H2DMsg_WasError) return;
         H2DScan_token0 = 6031L;
         break;
      case '#':
         if (pd_parsed) {
            if (nextis('#')) {
               inc();
               H2DScan_token0 = 6049L;
            }
            else H2DScan_token0 = 6048L;
            inc();
         }
         else if (begin_of_line) {
            inc();
            skip_blanks();
            if (scanstr->Adr[pos]==0) {
               H2DScan_GetToken();
               if (H2DMsg_WasError) return;
            }
            else {
               copy_before_splitter();
               if (find(preprocessor_directives)) {
                  pd_parsed = 1;
                  pd_define_parsed = H2DScan_token0==6050L;
                  pd_include_parsed = ((H2DScan_token0==6060L || H2DScan_token0==6080L)
                 || H2DScan_token0==6081L) || H2DScan_token0==6086L;
                  pd_header_parsed = H2DScan_token0==6088L;
                  H2DScan_comments = pd_define_parsed;
                  skip_pd();
               }
               else {
                  line = line_of_last_token_begin;
                  pos = pos_of_last_token_begin;
                  LongStrs_Assign("#", 2ul, &str);
                  LongStrs_Append(H2DScan_text->Adr, H2DScan_text->Len0,
                &str);
                  Warning(7L, (tmp0[0].adr = str->Adr, tmp0[1].val = 0,
                tmp0[2].val = str->Len0*1u-1, (X2C_LOC *)tmp0),
                3ul*sizeof(X2C_SEQ));
                  while (scanstr->Adr[pos]) inc();
                  LongStrs_Assign(logicalStr->Adr, logicalStr->Len0,
                &prevLogicalStr);
                  RdPartOfScanStr();
                  LongStrs_Assign(scanstr->Adr, scanstr->Len0, &logicalStr);
                  H2DScan_GetToken();
                  if (H2DMsg_WasError) return;
               }
            }
         }
         else {
            Error(8L, (tmp0[0].adr = "#", tmp0[1].val = 0,
                tmp0[2].val = 2u-1, (X2C_LOC *)tmp0), 3ul*sizeof(X2C_SEQ));
            return;
         }
         break;
      case '%':
         H2DScan_token0 = 6021L;
         if (nextis('=')) {
            inc();
            H2DScan_token0 = 6038L;
         }
         else H2DScan_token0 = 6021L;
         inc();
         break;
      case '&':
         if (nextis('&')) {
            inc();
            H2DScan_token0 = 6029L;
         }
         else if (nextis('=')) {
            inc();
            H2DScan_token0 = 6043L;
         }
         else H2DScan_token0 = 6022L;
         inc();
         break;
      case '\'':
         get_str_const('\'');
         if (H2DMsg_WasError) return;
         if (LongStrs_Length1(H2DScan_text)>1L) {
            Error(9L, (tmp0[0].adr = "", tmp0[1].val = 0, tmp0[2].val = 1u-1,
                 (X2C_LOC *)tmp0), 3ul*sizeof(X2C_SEQ));
            return;
         }
         H2DScan_token0 = 6030L;
         break;
      case '(':
         H2DScan_token0 = 6006L;
         inc();
         break;
      case ')':
         H2DScan_token0 = 6007L;
         inc();
         break;
      case '*':
         if (nextis('=')) {
            inc();
            H2DScan_token0 = 6036L;
         }
         else {
            H2DScan_token0 = 6019L;
         }
         inc();
         break;
      case '+':
         if (nextis('=')) {
            inc();
            H2DScan_token0 = 6034L;
         }
         else H2DScan_token0 = 6002L;
         inc();
         break;
      case ',':
         H2DScan_token0 = 6005L;
         inc();
         break;
      case '-':
         if (nextis('=')) {
            inc();
            H2DScan_token0 = 6035L;
         }
         else if (nextis('>')) {
            inc();
            H2DScan_token0 = 6066L;
         }
         else H2DScan_token0 = 6003L;
         inc();
         break;
      case '.':
         if (nextis('.') && is(pos+2L, '.')) {
            H2DScan_token0 = 6004L;
            inc();
            inc();
         }
         else if ((X2C_CARD8)scanstr->Adr[pos+1L]>='0' && (X2C_CARD8)
                scanstr->Adr[pos+1L]<='9') {
            copy_before_splitter();
            H2DScan_token0 = 6076L;
            check_number(&H2DScan_text);
         }
         else H2DScan_token0 = 6044L;
         inc();
         break;
      case '/':
         if (nextis('*')) {
            skipp_eol = 0;
            old_line = line;
            old_pos = pos;
            inc();
            inc();
            H2DScan_token0 = 6065L;
            was_blank = 1;
            adt_NewList(&comments_list);
            for (;;) {
               while (!is(pos, 0) && (!is(pos, '*') || !nextis('/'))) {
                  if (is(pos, '\032')) {
                     line = old_line;
                     pos = old_pos;
                     Error(10L, (tmp0[0].adr = "", tmp0[1].val = 0,
                tmp0[2].val = 1u-1, (X2C_LOC *)tmp0), 3ul*sizeof(X2C_SEQ));
                     return;
                  }
                  LongStrs_AppendChar(scanstr->Adr[pos], &H2DScan_text);
                  inc();
               }
               if (is(pos, 0)) {
                  next_token = 0;
                  H2DScan_NewToken(&next_token);
                  LongStrs_Append(scanstr->Adr, scanstr->Len0, &logicalStr);
                  RdPartOfScanStr();
                  LongStrs_Assign("", 1ul, &H2DScan_text);
                  X2C_CALL(adt_Insert_0,X2C_GET_TD(comments_list),
                14)(comments_list, (adt_Element)next_token);
               }
               else {
                  skipp_eol = 1;
                  inc();
                  inc();
                  next_token = 0;
                  H2DScan_NewToken(&next_token);
                  if (!X2C_CALL(adt_IsEmpty_1,X2C_GET_TD(comments_list),
                4)(comments_list)) {
                     X2C_CALL(adt_Insert_0,X2C_GET_TD(comments_list),
                14)(comments_list, (adt_Element)next_token);
                  }
                  else putToken(&next_token);
                  break;
               }
            }
            if (!H2DScan_comments || H2DScan_skipping_mode) {
               H2DScan_GetToken();
               if (H2DMsg_WasError) return;
               adt_Deallocate((adt_Element)comments_list);
            }
            else if (!X2C_CALL(adt_IsEmpty_1,X2C_GET_TD(comments_list),
                4)(comments_list)) {
               format_comments(comments_list, old_pos);
               adt_Deallocate((adt_Element)tokens);
               tokens = comments_list;
               H2DScan_GetToken();
               if (H2DMsg_WasError) return;
            }
            else adt_Deallocate((adt_Element)comments_list);
         }
         else if (nextis('/') && (H2DCfg_CPPComment || H2DScan_prj_cfg_on)) {
            inc();
            inc();
            H2DScan_token0 = 6065L;
            was_blank = 1;
            while (!is(pos, 0)) {
               LongStrs_AppendChar(scanstr->Adr[pos], &H2DScan_text);
               inc();
            }
            if (!H2DScan_comments || H2DScan_skipping_mode) {
               H2DScan_GetToken();
               if (H2DMsg_WasError) return;
            }
         }
         else if (nextis('=')) {
            inc();
            inc();
            H2DScan_token0 = 6037L;
         }
         else {
            H2DScan_token0 = 6020L;
            inc();
         }
         break;
      case '0':
      case '1':
      case '2':
      case '3':
      case '4':
      case '5':
      case '6':
      case '7':
      case '8':
      case '9':
         copy_before_splitter();
         if (is(pos, '.')) copy_before_splitter();
         LongStrs_Assign(H2DScan_text->Adr, H2DScan_text->Len0,
                &H2DScan_original_text);
         tmp = H2DScan_skipping_mode;
         H2DScan_skipping_mode = 1;
         check_number(&H2DScan_text);
         H2DScan_skipping_mode = tmp;
         if (bad_const) {
            LongStrs_Assign(H2DScan_original_text->Adr,
                H2DScan_original_text->Len0, &H2DScan_text);
            if ((is(pos-1L, 'E') || is(pos-1L, 'e')) && (is(pos,
                '+') || is(pos, '-'))) copy_before_splitter();
            LongStrs_Assign(H2DScan_text->Adr, H2DScan_text->Len0,
                &H2DScan_original_text);
            check_number(&H2DScan_text);
         }
         break;
      case ';':
         H2DScan_token0 = 6010L;
         inc();
         break;
      case ':':
         H2DScan_token0 = 6000L;
         inc();
         break;
      case '<':
         if (nextis('=')) {
            H2DScan_token0 = 6017L;
            inc();
         }
         else if (nextis('<')) {
            inc();
            if (nextis('=')) {
               inc();
               H2DScan_token0 = 6041L;
            }
            else H2DScan_token0 = 6025L;
         }
         else H2DScan_token0 = 6015L;
         inc();
         break;
      case '=':
         if (nextis('=')) {
            H2DScan_token0 = 6078L;
            inc();
         }
         else H2DScan_token0 = 6013L;
         inc();
         break;
      case '>':
         if (nextis('=')) {
            H2DScan_token0 = 6016L;
            inc();
         }
         else if (nextis('>')) {
            inc();
            if (nextis('=')) {
               inc();
               H2DScan_token0 = 6042L;
            }
            else H2DScan_token0 = 6026L;
         }
         else {
            H2DScan_token0 = 6014L;
         }
         inc();
         break;
      case '?':
         H2DScan_token0 = 6011L;
         inc();
         break;
      case '[':
         H2DScan_token0 = 6045L;
         inc();
         break;
      case ']':
         H2DScan_token0 = 6046L;
         inc();
         break;
      case '^':
         if (nextis('=')) {
            inc();
            H2DScan_token0 = 6040L;
         }
         else H2DScan_token0 = 6024L;
         inc();
         break;
      case 'A':
      case 'B':
      case 'C':
      case 'D':
      case 'E':
      case 'F':
      case 'G':
      case 'H':
      case 'I':
      case 'J':
      case 'K':
      case 'L':
      case 'M':
      case 'N':
      case 'O':
      case 'P':
      case 'Q':
      case 'R':
      case 'S':
      case 'T':
      case 'U':
      case 'V':
      case 'W':
      case 'X':
      case 'Y':
      case 'Z':
      case '_':
      case 'a':
      case 'b':
      case 'c':
      case 'd':
      case 'e':
      case 'f':
      case 'g':
      case 'h':
      case 'i':
      case 'j':
      case 'k':
      case 'l':
      case 'm':
      case 'n':
      case 'o':
      case 'p':
      case 'q':
      case 'r':
      case 's':
      case 't':
      case 'u':
      case 'v':
      case 'w':
      case 'x':
      case 'y':
      case 'z':
         copy_before_splitter();
         LongStrs_Assign(H2DScan_text->Adr, H2DScan_text->Len0,
                &H2DScan_original_text);
         if (!pd_parsed && find_replacement()) {
            if (H2DMsg_WasError) return;
            H2DScan_GetToken();
            if (H2DMsg_WasError) return;
         }
         else if (pd_define_parsed) {
            pd_define_parsed = 0;
            if (is(pos, '(')) H2DScan_token0 = 6071L;
            else H2DScan_token0 = 6070L;
         }
         else if (!find(keywords)) H2DScan_token0 = 6001L;
         break;
      case '{':
         H2DScan_token0 = 6008L;
         inc();
         break;
      case '|':
         if (nextis('|')) {
            inc();
            H2DScan_token0 = 6028L;
         }
         else if (nextis('=')) {
            inc();
            H2DScan_token0 = 6039L;
         }
         else H2DScan_token0 = 6023L;
         inc();
         break;
      case '}':
         H2DScan_token0 = 6009L;
         inc();
         break;
      case '~':
         H2DScan_token0 = 6027L;
         inc();
         break;
      default:;
         str = 0;
         LongStrs_AppendChar(scanstr->Adr[pos], &str);
         Error(8L, (tmp0[0].adr = str->Adr, tmp0[1].val = 0,
                tmp0[2].val = str->Len0*1u-1, (X2C_LOC *)tmp0),
                3ul*sizeof(X2C_SEQ));
         return;
      } /* end switch */
   }
   else H2DScan_token0 = 6064L;
   anonym1 = H2DObjs_CurrentHeader->name;
   H2DMsg_Progress0(anonym1->Adr, anonym1->Len0, total_lines);
} /* end GetToken() */


static void ins(KeyWord * kw, const X2C_CHAR w[], X2C_CARD32 w_len,
                X2C_INT32 c, X2C_BOOLEAN ext)
{
   X2C_NEW(&H2DScan_KeyWordDesc_desc,(X2C_ADDRESS*)kw,
                sizeof(struct H2DScan_KeyWordDesc),0);
   X2C_CALL(adt_SetName_,X2C_GET_TD(*kw),1)((adt_NamedElement)*kw, w, w_len);
   (*kw)->code = c;
   (*kw)->ext = ext;
   X2C_CALL(adt_Insert_,X2C_GET_TD(keywords),11)(keywords, (adt_Element)*kw);
} /* end ins() */


static void InitKeyWordTree(void)
{
   KeyWord kw = 0;
   adt_NewTree(&keywords);
   ins(&kw, "int", 4ul, 5000L, 0);
   ins(&kw, "double", 7ul, 5001L, 0);
   ins(&kw, "asm", 4ul, 5004L, 0);
   ins(&kw, "break", 6ul, 5005L, 0);
   ins(&kw, "continue", 9ul, 5008L, 0);
   ins(&kw, "const", 6ul, 5009L, 0);
   ins(&kw, "enum", 5ul, 5012L, 0);
   ins(&kw, "else", 5ul, 5013L, 0);
   ins(&kw, "for", 4ul, 5016L, 0);
   ins(&kw, "if", 3ul, 5017L, 0);
   ins(&kw, "register", 9ul, 5020L, 0);
   ins(&kw, "long", 5ul, 5021L, 0);
   ins(&kw, "sizeof", 7ul, 5024L, 0);
   ins(&kw, "union", 6ul, 5025L, 0);
   ins(&kw, "unsigned", 9ul, 5028L, 0);
   ins(&kw, "void", 5ul, 5029L, 0);
   ins(&kw, "case", 5ul, 5002L, 0);
   ins(&kw, "auto", 5ul, 5003L, 0);
   ins(&kw, "default", 8ul, 5006L, 0);
   ins(&kw, "char", 5ul, 5007L, 0);
   ins(&kw, "do", 3ul, 5010L, 0);
   ins(&kw, "float", 6ul, 5011L, 0);
   ins(&kw, "extern", 7ul, 5014L, 0);
   ins(&kw, "goto", 5ul, 5015L, 0);
   ins(&kw, "struct", 7ul, 5018L, 0);
   ins(&kw, "short", 6ul, 5019L, 0);
   ins(&kw, "return", 7ul, 5022L, 0);
   ins(&kw, "static", 7ul, 5023L, 0);
   ins(&kw, "switch", 7ul, 5026L, 0);
   ins(&kw, "typedef", 8ul, 5027L, 0);
   ins(&kw, "while", 6ul, 5030L, 0);
   ins(&kw, "signed", 7ul, 5031L, 0);
   ins(&kw, "volatile", 9ul, 5032L, 0);
   ins(&kw, "interrupt", 10ul, 5033L, 0);
   ins(&kw, "pascal", 7ul, 5034L, 0);
   ins(&kw, "fortran", 8ul, 5035L, 0);
   ins(&kw, "cdecl", 6ul, 5036L, 0);
   ins(&kw, "far", 4ul, 5038L, 0);
   ins(&kw, "near", 5ul, 5039L, 0);
   ins(&kw, "huge", 5ul, 5040L, 0);
   ins(&kw, "syscall", 8ul, 5037L, 0);
} /* end InitKeyWordTree() */


static void ins0(KeyWord * n, const X2C_CHAR w[], X2C_CARD32 w_len,
                X2C_INT32 c, X2C_BOOLEAN ext)
{
   X2C_NEW(&H2DScan_KeyWordDesc_desc,(X2C_ADDRESS*)n,
                sizeof(struct H2DScan_KeyWordDesc),0);
   X2C_CALL(adt_SetName_,X2C_GET_TD(*n),1)((adt_NamedElement)*n, w, w_len);
   (*n)->code = c;
   (*n)->ext = ext;
   X2C_CALL(adt_Insert_,X2C_GET_TD(preprocessor_directives),
                11)(preprocessor_directives, (adt_Element)*n);
} /* end ins() */


static void InitPreProcessorDirectivesTree(void)
{
   KeyWord n = 0;
   ins0(&n, "define", 7ul, 6050L, 0);
   ins0(&n, "if", 3ul, 6051L, 0);
   ins0(&n, "endif", 6ul, 6052L, 0);
   ins0(&n, "elif", 5ul, 6053L, 0);
   ins0(&n, "else", 5ul, 6054L, 0);
   ins0(&n, "ifdef", 6ul, 6055L, 0);
   ins0(&n, "ifndef", 7ul, 6056L, 0);
   ins0(&n, "undef", 6ul, 6057L, 0);
   ins0(&n, "line", 5ul, 6058L, 0);
   ins0(&n, "error", 6ul, 6059L, 0);
   ins0(&n, "include", 8ul, 6060L, 0);
   ins0(&n, "pragma", 7ul, 6061L, 0);
   ins0(&n, "merge", 6ul, 6080L, 1);
   ins0(&n, "module", 7ul, 6081L, 1);
   ins0(&n, "end", 4ul, 6082L, 1);
   ins0(&n, "footer", 7ul, 6085L, 1);
   ins0(&n, "name", 5ul, 6086L, 1);
   ins0(&n, "variant", 8ul, 6087L, 1);
   ins0(&n, "header", 7ul, 6088L, 1);
} /* end InitPreProcessorDirectivesTree() */


static void InitNonPresentableCharArray(void)
{
   X2C_INT32 i;
   for (i = 0L; i<=255L; i++) {
      non_presentable_char_array[i] = (X2C_CHAR)i;
   } /* end for */
   non_presentable_char_array[110UL] = 0xAU ;
   non_presentable_char_array[116UL] = 0x9U ;
   non_presentable_char_array[118UL] = 0xBU ;
   non_presentable_char_array[98UL] = 0x8U ;
   non_presentable_char_array[114UL] = 0xDU ;
   non_presentable_char_array[102UL] = 0xCU ;
   non_presentable_char_array[97UL] = 0x7U ;
   non_presentable_char_array[39UL] = 0x2CU ;
   non_presentable_char_array[34UL] = 0x22U ;
   non_presentable_char_array[92UL] = 0x5CU ;
} /* end InitNonPresentableCharArray() */


static void InitTmpVars(void)
{
   LongStrs_Assign("                                                         \
                      ", 80ul, &tmp_str_for_formatting_comment);
   X2C_NEW(&H2DScan_KeyWordDesc_desc,
                (X2C_ADDRESS*) &tmp_pattr_for_finding_keywords,
                sizeof(struct H2DScan_KeyWordDesc),0);
   X2C_NEW(&H2DObjs_ReplacementDesc_desc,
                (X2C_ADDRESS*) &tmp_pattr_for_finding_replacem,
                sizeof(struct H2DObjs_ReplacementDesc),0);
   adt_NewList(&empty_token_list);
} /* end InitTmpVars() */


static void * H2DScan_offs[] = {
   &H2DScan_original_text,
   &H2DScan_text,
   &keywords,
   &preprocessor_directives,
   &file_name,
   &files_stack,
   &replacements,
   &replacement,
   &scanstr,
   &tokens,
   &logicalStr,
   &prevLogicalStr,
   &tmp_pattr_for_finding_keywords,
   &empty_token_list,
   &tmp_pattr_for_finding_replacem,
   &tmp_str_for_formatting_comment,
   X2C_OFS_END
};
static X2C_PROC H2DScan_cmds[] = { H2DScan_Close,H2DScan_GetToken,
                H2DScan_Init,0 };
static X2C_CHAR * H2DScan_cnms[] = { "Close","GetToken","Init",0 };
struct X2C_MD_STR H2DScan_desc = {
  0, 0, "H2DScan",H2DScan_offs,H2DScan_cmds,H2DScan_cnms,&H2DScan_TDesc_desc
};

extern void H2DScan_BEGIN(void)
{
   static int H2DScan_init = 0;
   if (H2DScan_init) return;
   H2DScan_init = 1;
   Printf_BEGIN();
   LongConv_BEGIN();
   WholeStr_BEGIN();
   LongStrs_BEGIN();
   H2DCfg_BEGIN();
   H2DMsg_BEGIN();
   H2DFile_BEGIN();
   adt_BEGIN();
   H2DObjs_BEGIN();
   X2C_MODULE(&H2DScan_desc);
   H2DScan_Init();
   file_name = 0;
   H2DScan_extensions = 1;
   adt_NewTree(&keywords);
   adt_NewTree(&preprocessor_directives);
   InitKeyWordTree();
   InitPreProcessorDirectivesTree();
   InitNonPresentableCharArray();
   InitTmpVars();
}

